
<div class="slides">
  <section><br/><br/><br/>
    <h1>Visualizing Concurrency in Go</h1>
    <h5>GopherCon, July 11, 2016</h5>
    <h5>Ivan Danyliuk, Typeform</h5>
  </section>
  <section>
    <h3>Number forms</h3><img src="images/numberforms.png" width="70%"/>
  </section>
  <section>
    <h3>Visualizations</h3><img src="images/visuals.png" width="90%"/>
  </section>
  <section><br/><br/><br/><br/>
    <h1>How do you see</h1>
    <h1>concurrency?</h1>
  </section>
  <section><br/><br/><img src="images/cortex.png" width="90%"/></section>
  <section><br/><br/><br/>
    <h1>Introducing</h1>
    <h1>GoTrace tool</h1>
  </section>
  <section>
    <h3>Hello, world!</h3>
    <pre><!-- HTML generated using hilite.me --><div style="background: #000000; overflow:auto;width:auto;border: none; border-width: 0px; padding: 0em; background: #111;"><pre style="margin: 0; line-height: 125%"><span style="color: #cd00cd">package</span> <span style="color: #cccccc">main</span>

<span style="color: #00cd00">func</span> <span style="color: #cccccc">main()</span> <span style="color: #cccccc">{</span>
    <span style="color: #cccccc">ch</span> <span style="color: #3399cc">:=</span> <span style="color: #cd00cd">make</span><span style="color: #cccccc">(</span><span style="color: #00cd00">chan</span> <span style="color: #00cd00">int</span><span style="color: #cccccc">)</span>

    <span style="color: #cdcd00">go</span> <span style="color: #00cd00">func</span><span style="color: #cccccc">()</span> <span style="color: #cccccc">{</span>
        <span style="color: #cccccc">ch</span> <span style="color: #3399cc">&lt;-</span> <span style="color: #cd00cd">42</span>
    <span style="color: #cccccc">}()</span>

    <span style="color: #3399cc">&lt;-</span><span style="color: #cccccc">ch</span>
<span style="color: #cccccc">}</span>
</pre></div>

</pre>
  </section>
    <section>
      <h3>Hello, world!</h3>
      <canvas data-sample="hello01" style="display:inline"></canvas>
    </section>
  <section>
    <h3>Timer</h3>
    <pre><!-- HTML generated using hilite.me --><div style="background: #000000; overflow:auto;width:auto;border: none; border-width: 0px; padding: 0em; background: #111;"><pre style="margin: 0; line-height: 125%"><span style="color: #00cd00">func</span> <span style="color: #cccccc">tick(d</span> <span style="color: #cccccc">time.Duration)</span> <span style="color: #3399cc">&lt;-</span><span style="color: #00cd00">chan</span> <span style="color: #00cd00">int</span> <span style="color: #cccccc">{</span>
	<span style="color: #cccccc">c</span> <span style="color: #3399cc">:=</span> <span style="color: #cd00cd">make</span><span style="color: #cccccc">(</span><span style="color: #00cd00">chan</span> <span style="color: #00cd00">int</span><span style="color: #cccccc">)</span>
	<span style="color: #cdcd00">go</span> <span style="color: #00cd00">func</span><span style="color: #cccccc">()</span> <span style="color: #cccccc">{</span>
		<span style="color: #cccccc">time.Sleep(d)</span>
		<span style="color: #cccccc">c</span> <span style="color: #3399cc">&lt;-</span> <span style="color: #cd00cd">1</span>
	<span style="color: #cccccc">}()</span>
	<span style="color: #cdcd00">return</span> <span style="color: #cccccc">c</span>
<span style="color: #cccccc">}</span>

<span style="color: #00cd00">func</span> <span style="color: #cccccc">main()</span> <span style="color: #cccccc">{</span>
	<span style="color: #cdcd00">for</span> <span style="color: #cccccc">i</span> <span style="color: #3399cc">:=</span> <span style="color: #cd00cd">0</span><span style="color: #cccccc">;</span> <span style="color: #cccccc">i</span> <span style="color: #cccccc">&lt;</span> <span style="color: #cd00cd">24</span><span style="color: #cccccc">;</span> <span style="color: #cccccc">i</span><span style="color: #3399cc">++</span> <span style="color: #cccccc">{</span>
		<span style="color: #cccccc">c</span> <span style="color: #3399cc">:=</span> <span style="color: #cccccc">tick(</span><span style="color: #cd00cd">100</span> <span style="color: #3399cc">*</span> <span style="color: #cccccc">time.Millisecond)</span>
		<span style="color: #3399cc">&lt;-</span><span style="color: #cccccc">c</span>
	<span style="color: #cccccc">}</span>
<span style="color: #cccccc">}</span>
</pre></div>

</pre>
  </section>
    <section>
      <h3>Timer</h3>
      <canvas data-sample="timer01" style="display:inline"></canvas>
    </section>
  <section>
    <h3>Ping-pong</h3>
    <pre><!-- HTML generated using hilite.me --><div style="background: #000000; overflow:auto;width:auto;border: none; border-width: 0px; padding: 0em; background: #111;"><pre style="margin: 0; line-height: 125%"><span style="color: #00cd00">func</span> <span style="color: #cccccc">main()</span> <span style="color: #cccccc">{</span>
	<span style="color: #00cd00">var</span> <span style="color: #cccccc">Ball</span> <span style="color: #00cd00">int</span>
	<span style="color: #cccccc">table</span> <span style="color: #3399cc">:=</span> <span style="color: #cd00cd">make</span><span style="color: #cccccc">(</span><span style="color: #00cd00">chan</span> <span style="color: #00cd00">int</span><span style="color: #cccccc">)</span>
	<span style="color: #cdcd00">go</span> <span style="color: #cccccc">player(table)</span>
	<span style="color: #cdcd00">go</span> <span style="color: #cccccc">player(table)</span>

	<span style="color: #cccccc">table</span> <span style="color: #3399cc">&lt;-</span> <span style="color: #cccccc">Ball</span>
	<span style="color: #cccccc">time.Sleep(</span><span style="color: #cd00cd">1</span> <span style="color: #3399cc">*</span> <span style="color: #cccccc">time.Second)</span>
	<span style="color: #3399cc">&lt;-</span><span style="color: #cccccc">table</span>
<span style="color: #cccccc">}</span>

<span style="color: #00cd00">func</span> <span style="color: #cccccc">player(table</span> <span style="color: #00cd00">chan</span> <span style="color: #00cd00">int</span><span style="color: #cccccc">)</span> <span style="color: #cccccc">{</span>
	<span style="color: #cdcd00">for</span> <span style="color: #cccccc">{</span>
		<span style="color: #cccccc">ball</span> <span style="color: #3399cc">:=</span> <span style="color: #3399cc">&lt;-</span><span style="color: #cccccc">table</span>
		<span style="color: #cccccc">ball</span><span style="color: #3399cc">++</span>
		<span style="color: #cccccc">time.Sleep(</span><span style="color: #cd00cd">100</span> <span style="color: #3399cc">*</span> <span style="color: #cccccc">time.Millisecond)</span>
		<span style="color: #cccccc">table</span> <span style="color: #3399cc">&lt;-</span> <span style="color: #cccccc">ball</span>
	<span style="color: #cccccc">}</span>
<span style="color: #cccccc">}</span>
</pre></div>
</pre>
  </section>
  <section>
    <h3>Ping-pong</h3><img src="images/tabletennis.gif"/>
  </section>
    <section>
      <h3>Ping-pong</h3>
      <canvas data-sample="pingpong01" style="display:inline"></canvas>
    </section>
  <section transition="none">
    <h3>Ping-pong #3</h3>
    <pre><!-- HTML generated using hilite.me --><div style="background: #000000; overflow:auto;width:auto;border: none; border-width: 0px; padding: 0em; background: #111;"><pre style="margin: 0; line-height: 125%"> <span style="opacity: 0.5"> <span style="color: #00cd00">func</span> <span style="color: #cccccc">main()</span> <span style="color: #cccccc">{</span>
	<span style="color: #00cd00">var</span> <span style="color: #cccccc">Ball</span> <span style="color: #00cd00">int</span>
	<span style="color: #cccccc">table</span> <span style="color: #3399cc">:=</span> <span style="color: #cd00cd">make</span><span style="color: #cccccc">(</span><span style="color: #00cd00">chan</span> <span style="color: #00cd00">int</span><span style="color: #cccccc">)</span> </span>
	<span style="opacity: 1">
	<span style="color: #cdcd00">go</span> <span style="color: #cccccc">player(table)</span>
	<span style="color: #cdcd00">go</span> <span style="color: #cccccc">player(table)</span>
	<span style="color: #cdcd00">go</span> <span style="color: #cccccc">player(table)</span>
	</span>
	<span style="opacity: 0.5"><span style="color: #cccccc">table</span> <span style="color: #3399cc">&lt;-</span> <span style="color: #cccccc">Ball</span>
	<span style="color: #cccccc">time.Sleep(</span><span style="color: #cd00cd">1</span> <span style="color: #3399cc">*</span> <span style="color: #cccccc">time.Second)</span>
	<span style="color: #3399cc">&lt;-</span><span style="color: #cccccc">table</span>
<span style="color: #cccccc">}</span>

<span style="color: #00cd00">func</span> <span style="color: #cccccc">player(table</span> <span style="color: #00cd00">chan</span> <span style="color: #00cd00">int</span><span style="color: #cccccc">)</span> <span style="color: #cccccc">{</span>
	<span style="color: #cdcd00">for</span> <span style="color: #cccccc">{</span>
		<span style="color: #cccccc">ball</span> <span style="color: #3399cc">:=</span> <span style="color: #3399cc">&lt;-</span><span style="color: #cccccc">table</span>
		<span style="color: #cccccc">ball</span><span style="color: #3399cc">++</span>
		<span style="color: #cccccc">time.Sleep(</span><span style="color: #cd00cd">100</span> <span style="color: #3399cc">*</span> <span style="color: #cccccc">time.Millisecond)</span>
		<span style="color: #cccccc">table</span> <span style="color: #3399cc">&lt;-</span> <span style="color: #cccccc">ball</span>
	<span style="color: #cccccc">}</span>
<span style="color: #cccccc">}</span> </span> </pre></div>
</pre>
  </section>
    <section>
      <h3>Ping-pong #3</h3>
      <canvas data-sample="pingpong03" style="display:inline"></canvas>
    </section>
  <section>
    <h3>Ping-pong #36</h3>
    <pre><!-- HTML generated using hilite.me --><div style="background: #000000; overflow:auto;width:auto;border: none; border-width: 0px; padding: 0em; background: #111;"><pre style="margin: 0; line-height: 125%"><span style="opacity: 0.5"><span style="color: #00cd00">func</span> <span style="color: #cccccc">main()</span> <span style="color: #cccccc">{</span>
	<span style="color: #00cd00">var</span> <span style="color: #cccccc">Ball</span> <span style="color: #00cd00">int</span>
	<span style="color: #cccccc">table</span> <span style="color: #3399cc">:=</span> <span style="color: #cd00cd">make</span><span style="color: #cccccc">(</span><span style="color: #00cd00">chan</span> <span style="color: #00cd00">int</span><span style="color: #cccccc">)</span></span>

	<span style="opacity: 1"><span style="color: #cdcd00">for</span> <span style="color: #cccccc">i</span> <span style="color: #3399cc">:=</span> <span style="color: #cd00cd">0</span><span style="color: #cccccc">;</span> <span style="color: #cccccc">i</span> <span style="color: #cccccc">&lt;</span> <span style="color: #cd00cd">36</span><span style="color: #cccccc">;</span> <span style="color: #cccccc">i</span><span style="color: #3399cc">++</span> <span style="color: #cccccc">{</span>
		<span style="color: #cdcd00">go</span> <span style="color: #cccccc">player(table)</span>
	<span style="color: #cccccc">}</span></span>

	<span style="opacity:0.5"><span style="color: #cccccc">table</span> <span style="color: #3399cc">&lt;-</span> <span style="color: #cccccc">Ball</span>
	<span style="color: #cccccc">time.Sleep(</span><span style="color: #cd00cd">1</span> <span style="color: #3399cc">*</span> <span style="color: #cccccc">time.Second)</span>
	<span style="color: #3399cc">&lt;-</span><span style="color: #cccccc">table</span>
<span style="color: #cccccc">}</span>

<span style="color: #00cd00">func</span> <span style="color: #cccccc">player(table</span> <span style="color: #00cd00">chan</span> <span style="color: #00cd00">int</span><span style="color: #cccccc">)</span> <span style="color: #cccccc">{</span>
	<span style="color: #cdcd00">for</span> <span style="color: #cccccc">{</span>
		<span style="color: #cccccc">ball</span> <span style="color: #3399cc">:=</span> <span style="color: #3399cc">&lt;-</span><span style="color: #cccccc">table</span>
		<span style="color: #cccccc">ball</span><span style="color: #3399cc">++</span>
		<span style="color: #cccccc">time.Sleep(</span><span style="color: #cd00cd">100</span> <span style="color: #3399cc">*</span> <span style="color: #cccccc">time.Millisecond)</span>
		<span style="color: #cccccc">table</span> <span style="color: #3399cc">&lt;-</span> <span style="color: #cccccc">ball</span>
	<span style="color: #cccccc">}</span>
<span style="color: #cccccc">}</span></span>
</pre></div>
</pre>
  </section>
    <section>
      <h3>Ping-pong #36</h3>
      <canvas data-sample="pingpong36" style="display:inline"></canvas>
    </section>
  <section><br/><br/><br/><br/><br/>
    <h1>Messaging patterns</h1>
  </section>
  <section>
    <h3>Fan-in</h3>
    <pre><!-- HTML generated using hilite.me --><div style="background: #000000; overflow:auto;width:auto;border: none; border-width: 0px; padding: 0em; background: #111;"><pre style="margin: 0; line-height: 125%"><span style="color: #00cd00">func</span> <span style="color: #cccccc">producer(ch</span> <span style="color: #00cd00">chan</span> <span style="color: #00cd00">int</span><span style="color: #cccccc">,</span> <span style="color: #cccccc">d</span> <span style="color: #cccccc">time.Duration)</span> <span style="color: #cccccc">{</span>
	<span style="color: #cdcd00">for</span> <span style="color: #cccccc">{</span>
		<span style="color: #cccccc">ch</span> <span style="color: #3399cc">&lt;-</span> <span style="color: #cccccc">i</span>
		<span style="color: #cccccc">time.Sleep(d)</span>
	<span style="color: #cccccc">}</span>
<span style="color: #cccccc">}</span>

<span style="color: #00cd00">func</span> <span style="color: #cccccc">reader(out</span> <span style="color: #00cd00">chan</span> <span style="color: #00cd00">int</span><span style="color: #cccccc">)</span> <span style="color: #cccccc">{</span>
	<span style="color: #cdcd00">for</span> <span style="color: #cccccc">{</span> <span style="color: #3399cc">&lt;-</span><span style="color: #cccccc">out</span> <span style="color: #cccccc">}</span>
<span style="color: #cccccc">}</span>

<span style="color: #00cd00">func</span> <span style="color: #cccccc">main()</span> <span style="color: #cccccc">{</span>
	<span style="color: #cccccc">ch,</span> <span style="color: #cccccc">out</span> <span style="color: #3399cc">:=</span> <span style="color: #cd00cd">make</span><span style="color: #cccccc">(</span><span style="color: #00cd00">chan</span> <span style="color: #00cd00">int</span><span style="color: #cccccc">),</span> <span style="color: #cd00cd">make</span><span style="color: #cccccc">(</span><span style="color: #00cd00">chan</span> <span style="color: #00cd00">int</span><span style="color: #cccccc">)</span>
	<span style="color: #cdcd00">go</span> <span style="color: #cccccc">producer(ch,</span> <span style="color: #cd00cd">100</span><span style="color: #3399cc">*</span><span style="color: #cccccc">time.Millisecond)</span>
	<span style="color: #cdcd00">go</span> <span style="color: #cccccc">producer(ch,</span> <span style="color: #cd00cd">300</span><span style="color: #3399cc">*</span><span style="color: #cccccc">time.Millisecond)</span>
	<span style="color: #cdcd00">go</span> <span style="color: #cccccc">reader(out)</span>
	<span style="color: #cdcd00">for</span> <span style="color: #cccccc">{</span> <span style="color: #cccccc">out</span> <span style="color: #3399cc">&lt;-</span> <span style="color: #3399cc">&lt;-</span><span style="color: #cccccc">ch</span> <span style="color: #cccccc">}</span>
<span style="color: #cccccc">}</span>
</pre></div>

</pre>
  </section>
    <section>
      <h3>Fan in</h3>
      <canvas data-sample="fanin" style="display:inline"></canvas>
    </section>
  <section>
    <h3>Servers</h3>
    <pre><!-- HTML generated using hilite.me --><div style="background: #000000; overflow:auto;width:auto;border: none; border-width: 0px; padding: 0em; background: #111;"><pre style="margin: 0; line-height: 125%"><span style="color: #00cd00">func</span> <span style="color: #cccccc">handler(c</span> <span style="color: #cccccc">net.Conn)</span> <span style="color: #cccccc">{</span>
	<span style="color: #cccccc">c.Write([]</span><span style="color: #cd00cd">byte</span><span style="color: #cccccc">(</span><span style="color: #cd0000">&quot;ok&quot;</span><span style="color: #cccccc">))</span>
	<span style="color: #cccccc">c.Close()</span>
<span style="color: #cccccc">}</span>

<span style="color: #00cd00">func</span> <span style="color: #cccccc">main()</span> <span style="color: #cccccc">{</span>
	<span style="color: #cccccc">l,</span> <span style="color: #cccccc">err</span> <span style="color: #3399cc">:=</span> <span style="color: #cccccc">net.Listen(</span><span style="color: #cd0000">&quot;tcp&quot;</span><span style="color: #cccccc">,</span> <span style="color: #cd0000">&quot;:5000&quot;</span><span style="color: #cccccc">)</span>
	<span style="color: #cdcd00">if</span> <span style="color: #cccccc">err</span> <span style="color: #3399cc">!=</span> <span style="color: #cdcd00">nil</span> <span style="color: #cccccc">{</span>
		<span style="color: #cd00cd">panic</span><span style="color: #cccccc">(err)</span>
	<span style="color: #cccccc">}</span>
	<span style="color: #cdcd00">for</span> <span style="color: #cccccc">{</span>
		<span style="color: #cccccc">c,</span> <span style="color: #cccccc">err</span> <span style="color: #3399cc">:=</span> <span style="color: #cccccc">l.Accept()</span>
		<span style="color: #cdcd00">if</span> <span style="color: #cccccc">err</span> <span style="color: #3399cc">!=</span> <span style="color: #cdcd00">nil</span> <span style="color: #cccccc">{</span>
			<span style="color: #cdcd00">continue</span>
		<span style="color: #cccccc">}</span>
		<span style="color: #cdcd00">go</span> <span style="color: #cccccc">handler(c)</span>
	<span style="color: #cccccc">}</span>
<span style="color: #cccccc">}</span>
</pre></div>

</pre>
  </section>
    <section>
      <h3>Servers</h3>
      <canvas data-sample="server01" style="display:inline"></canvas>
    </section>
  <section>
    <h3>Servers</h3>
    <pre style="width: 55%; float: left; padding: 5px"><!-- HTML generated using hilite.me --><div style="background: #000000; overflow:auto;width:auto;border: none; border-width: 0px; padding: 0em; background: #111;"><pre style="margin: 0; line-height: 125%"><span style="color: #00cd00">func</span> <span style="color: #cccccc">handler(c</span> <span style="color: #cccccc">net.Conn,</span> <span style="color: #cccccc">ch</span> <span style="color: #00cd00">chan</span> <span style="color: #00cd00">string</span><span style="color: #cccccc">)</span> <span style="color: #cccccc">{</span>
	<span style="color: #cccccc">ch</span> <span style="color: #3399cc">&lt;-</span> <span style="color: #cd00cd">11</span> <span style="color: #000080">// something</span>
	<span style="color: #cccccc">c.Write([]</span><span style="color: #cd00cd">byte</span><span style="color: #cccccc">(</span><span style="color: #cd0000">&quot;ok&quot;</span><span style="color: #cccccc">))</span>
	<span style="color: #cccccc">c.Close()</span>
<span style="color: #cccccc">}</span>

<span style="opacity: 0.5"><span style="color: #00cd00">func</span> <span style="color: #cccccc">main()</span> <span style="color: #cccccc">{</span>
	<span style="color: #cccccc">l,</span> <span style="color: #cccccc">err</span> <span style="color: #3399cc">:=</span> <span style="color: #cccccc">net.Listen(</span><span style="color: #cd0000">&quot;tcp&quot;</span><span style="color: #cccccc">,</span> <span style="color: #cd0000">&quot;:5000&quot;</span><span style="color: #cccccc">)</span>
	<span style="color: #cdcd00">if</span> <span style="color: #cccccc">err</span> <span style="color: #3399cc">!=</span> <span style="color: #cdcd00">nil</span> <span style="color: #cccccc">{</span>
		<span style="color: #cd00cd">panic</span><span style="color: #cccccc">(err)</span>
	<span style="color: #cccccc">}</span></span>
	<span style="color: #cccccc">ch</span> <span style="color: #3399cc">:=</span> <span style="color: #cd00cd">make</span><span style="color: #cccccc">(</span><span style="color: #00cd00">chan</span> <span style="color: #00cd00">string</span><span style="color: #cccccc">)</span>
	<span style="color: #cdcd00">go</span> <span style="color: #cccccc">logger(ch)</span>
	<span style="opacity: 0.5"><span style="color: #cdcd00">go</span> <span style="color: #cccccc">server(l,</span> <span style="color: #cccccc">ch)</span>
	<span style="color: #cdcd00">select</span><span style="color: #cccccc">{}</span>
<span style="color: #cccccc">}</span></span>
</pre></div>

</pre>
    <pre style="width: 43%; float: right; padding: 5px"><!-- HTML generated using hilite.me --><div style="background: #000000; overflow:auto;width:auto;border: none; border-width: 0px; padding: 0em; background: #111;"><pre style="margin: 0; line-height: 125%"><span style="color: #00cd00">func</span> <span style="color: #cccccc">logger(ch</span> <span style="color: #00cd00">chan</span> <span style="color: #00cd00">int</span><span style="color: #cccccc">)</span> <span style="color: #cccccc">{</span>
	<span style="color: #cdcd00">for</span> <span style="color: #cccccc">{</span>
		<span style="color: #cccccc">fmt.Println(</span><span style="color: #3399cc">&lt;-</span><span style="color: #cccccc">ch)</span>
	<span style="color: #cccccc">}</span>
<span style="color: #cccccc">}</span>

<span style="opacity: 0.5"><span style="color: #00cd00">func</span> <span style="color: #cccccc">server(l</span> <span style="color: #cccccc">net.Listener,</span>
		<span style="color: #cccccc">ch</span> <span style="color: #00cd00">chan</span> <span style="color: #00cd00">int</span><span style="color: #cccccc">)</span> <span style="color: #cccccc">{</span>
	<span style="color: #cdcd00">for</span> <span style="color: #cccccc">{</span>
		<span style="color: #cccccc">c,</span> <span style="color: #cccccc">err</span> <span style="color: #3399cc">:=</span> <span style="color: #cccccc">l.Accept()</span>
		<span style="color: #cdcd00">if</span> <span style="color: #cccccc">err</span> <span style="color: #3399cc">!=</span> <span style="color: #cdcd00">nil</span> <span style="color: #cccccc">{</span>
			<span style="color: #cdcd00">continue</span>
		<span style="color: #cccccc">}</span>
		<span style="color: #cdcd00">go</span> <span style="color: #cccccc">handler(c,</span> <span style="color: #cccccc">ch)</span>
	<span style="color: #cccccc">}</span>
<span style="color: #cccccc">}</span></span>
</pre></div>

</pre>
  </section>
    <section>
      <h3>Servers</h3>
      <canvas data-sample="server02" style="display:inline"></canvas>
    </section>
  <section>
    <h3>Workers / Fan-out</h3>
    <pre style="width: 40%; float: left; padding: 5px"><!-- HTML generated using hilite.me --><div style="background: #000000; overflow:auto;width:auto;border: none; border-width: 0px; padding: 0em; background: #111;"><pre style="margin: 0; line-height: 125%"><span style="color: #00cd00">func</span> <span style="color: #cccccc">main()</span> <span style="color: #cccccc">{</span>
	<span style="color: #00cd00">var</span> <span style="color: #cccccc">wg</span> <span style="color: #cccccc">sync.WaitGroup</span>
	<span style="color: #cccccc">wg.Add(</span><span style="color: #cd00cd">36</span><span style="color: #cccccc">)</span>
	<span style="color: #cdcd00">go</span> <span style="color: #cccccc">pool(</span><span style="color: #3399cc">&amp;</span><span style="color: #cccccc">wg,</span> <span style="color: #cd00cd">36</span><span style="color: #cccccc">)</span>
	<span style="color: #cccccc">wg.Wait()</span>
<span style="color: #cccccc">}</span>

<span style="color: #00cd00">func</span> <span style="color: #cccccc">pool(wg</span> <span style="color: #3399cc">*</span><span style="color: #cccccc">sync.WaitGroup,</span> <span style="color: #cccccc">n</span> <span style="color: #00cd00">int</span><span style="color: #cccccc">)</span> <span style="color: #cccccc">{</span>
	<span style="color: #cccccc">tasks</span> <span style="color: #3399cc">:=</span> <span style="color: #cd00cd">make</span><span style="color: #cccccc">(</span><span style="color: #00cd00">chan</span> <span style="color: #00cd00">int</span><span style="color: #cccccc">)</span>
	<span style="color: #cdcd00">for</span> <span style="color: #cccccc">i</span> <span style="color: #3399cc">:=</span> <span style="color: #cd00cd">0</span><span style="color: #cccccc">;</span> <span style="color: #cccccc">i</span> <span style="color: #cccccc">&lt;</span> <span style="color: #cccccc">n;</span> <span style="color: #cccccc">i</span><span style="color: #3399cc">++</span> <span style="color: #cccccc">{</span>
		<span style="color: #cdcd00">go</span> <span style="color: #cccccc">worker(tasks,</span> <span style="color: #cccccc">wg)</span>
	<span style="color: #cccccc">}</span>
	<span style="color: #cdcd00">for</span> <span style="color: #cccccc">i</span> <span style="color: #3399cc">:=</span> <span style="color: #cd00cd">0</span><span style="color: #cccccc">;</span> <span style="color: #cccccc">i</span> <span style="color: #cccccc">&lt;</span> <span style="color: #cd00cd">50</span><span style="color: #cccccc">;</span> <span style="color: #cccccc">i</span><span style="color: #3399cc">++</span> <span style="color: #cccccc">{</span>
		<span style="color: #cccccc">tasks</span> <span style="color: #3399cc">&lt;-</span> <span style="color: #cccccc">i</span>
	<span style="color: #cccccc">}</span>
	<span style="color: #cd00cd">close</span><span style="color: #cccccc">(tasks)</span>
<span style="color: #cccccc">}</span>
</pre></div>

</pre>
    <pre style="width: 55%; float: right; padding: 5px"><!-- HTML generated using hilite.me --><div style="background: #000000; overflow:auto;width:auto;border: none; border-width: 0px; padding: 0em; background: #111;"><pre style="margin: 0; line-height: 125%"><span style="color: #00cd00">func</span> <span style="color: #cccccc">worker(tasks</span> <span style="color: #3399cc">&lt;-</span><span style="color: #00cd00">chan</span> <span style="color: #00cd00">int</span><span style="color: #cccccc">,</span>
		<span style="color: #cccccc">wg</span> <span style="color: #3399cc">*</span><span style="color: #cccccc">sync.WaitGroup)</span> <span style="color: #cccccc">{</span>
	<span style="color: #cdcd00">defer</span> <span style="color: #cccccc">wg.Done()</span>
	<span style="color: #cdcd00">for</span> <span style="color: #cccccc">{</span>
		<span style="color: #cccccc">task,</span> <span style="color: #cccccc">ok</span> <span style="color: #3399cc">:=</span> <span style="color: #3399cc">&lt;-</span><span style="color: #cccccc">tasks</span>
		<span style="color: #cdcd00">if</span> <span style="color: #cccccc">!ok</span> <span style="color: #cccccc">{</span>
			<span style="color: #cdcd00">return</span>
		<span style="color: #cccccc">}</span>
		<span style="color: #cccccc">d</span> <span style="color: #3399cc">:=</span> <span style="color: #cccccc">time.Duration(task)</span> 
			<span style="color: #3399cc">*</span> <span style="color: #cccccc">time.Millisecond</span>
		<span style="color: #cccccc">time.Sleep(d)</span>
		<span style="color: #cccccc">fmt.Println(</span><span style="color: #cd0000">&quot;processing task&quot;</span><span style="color: #cccccc">,</span> <span style="color: #cccccc">task)</span>
	<span style="color: #cccccc">}</span>
<span style="color: #cccccc">}</span>
</pre></div>

</pre>
  </section>
    <section>
      <h3>Workers</h3>
      <canvas data-sample="workers01" style="display:inline"></canvas>
    </section>
    <section>
      <h3>Subworkers</h3>
      <canvas data-sample="workers02" style="display:inline"></canvas>
    </section>
    <section>
      <h3>Server+Worker</h3>
      <canvas data-sample="server03" style="display:inline"></canvas>
    </section>
  <section>
    <h3>Concurrent prime sieve</h3>
    <pre style="width: 43%; float: left; padding: 5px"><!-- HTML generated using hilite.me --><div style="background: #000000; overflow:auto;width:auto;border: none; border-width: 0px; padding: 0em; background: #111;"><pre style="margin: 0; line-height: 125%"><span style="color: #cd00cd">package</span> <span style="color: #cccccc">main</span>

<span style="color: #cd00cd">import</span> <span style="color: #cd0000">&quot;fmt&quot;</span>

<span style="color: #00cd00">func</span> <span style="color: #cccccc">main()</span> <span style="color: #cccccc">{</span>
	<span style="color: #cccccc">ch</span> <span style="color: #3399cc">:=</span> <span style="color: #cd00cd">make</span><span style="color: #cccccc">(</span><span style="color: #00cd00">chan</span> <span style="color: #00cd00">int</span><span style="color: #cccccc">)</span>
	<span style="color: #cdcd00">go</span> <span style="color: #cccccc">Generate(ch)</span>
	<span style="color: #cdcd00">for</span> <span style="color: #cccccc">i</span> <span style="color: #3399cc">:=</span> <span style="color: #cd00cd">0</span><span style="color: #cccccc">;</span> <span style="color: #cccccc">i</span> <span style="color: #cccccc">&lt;</span> <span style="color: #cd00cd">10</span><span style="color: #cccccc">;</span> <span style="color: #cccccc">i</span><span style="color: #3399cc">++</span> <span style="color: #cccccc">{</span>
		<span style="color: #cccccc">prime</span> <span style="color: #3399cc">:=</span> <span style="color: #3399cc">&lt;-</span><span style="color: #cccccc">ch</span>
		<span style="color: #cccccc">fmt.Println(prime)</span>
		<span style="color: #cccccc">out</span> <span style="color: #3399cc">:=</span> <span style="color: #cd00cd">make</span><span style="color: #cccccc">(</span><span style="color: #00cd00">chan</span> <span style="color: #00cd00">int</span><span style="color: #cccccc">)</span>
		<span style="color: #cdcd00">go</span> <span style="color: #cccccc">Filter(ch,</span> <span style="color: #cccccc">out,</span> <span style="color: #cccccc">prime)</span>
		<span style="color: #cccccc">ch</span> <span style="color: #cccccc">=</span> <span style="color: #cccccc">out</span>
	<span style="color: #cccccc">}</span>
<span style="color: #cccccc">}</span>
</pre></div>

</pre>
    <pre style="width: 55%; float: right; padding: 5px"><!-- HTML generated using hilite.me --><div style="background: #000000; overflow:auto;width:auto;border: none; border-width: 0px; padding: 0em; background: #111;"><pre style="margin: 0; line-height: 125%"><span style="color: #00cd00">func</span> <span style="color: #cccccc">Generate(ch</span> <span style="color: #00cd00">chan</span><span style="color: #3399cc">&lt;-</span> <span style="color: #00cd00">int</span><span style="color: #cccccc">)</span> <span style="color: #cccccc">{</span>
	<span style="color: #cdcd00">for</span> <span style="color: #cccccc">i</span> <span style="color: #3399cc">:=</span> <span style="color: #cd00cd">2</span><span style="color: #cccccc">;</span> <span style="color: #cccccc">;</span> <span style="color: #cccccc">i</span><span style="color: #3399cc">++</span> <span style="color: #cccccc">{</span>
		<span style="color: #cccccc">ch</span> <span style="color: #3399cc">&lt;-</span> <span style="color: #cccccc">i</span>
	<span style="color: #cccccc">}</span>
<span style="color: #cccccc">}</span>

<span style="color: #00cd00">func</span> <span style="color: #cccccc">Filter(in,</span> <span style="color: #cccccc">out</span> <span style="color: #3399cc">&lt;-</span><span style="color: #00cd00">chan</span> <span style="color: #00cd00">int</span><span style="color: #cccccc">,</span> <span style="color: #cccccc">prime</span> <span style="color: #00cd00">int</span><span style="color: #cccccc">)</span> <span style="color: #cccccc">{</span>
	<span style="color: #cdcd00">for</span> <span style="color: #cccccc">{</span>
		<span style="color: #cccccc">i</span> <span style="color: #3399cc">:=</span> <span style="color: #3399cc">&lt;-</span><span style="color: #cccccc">in</span>
		<span style="color: #cdcd00">if</span> <span style="color: #cccccc">i</span><span style="color: #3399cc">%</span><span style="color: #cccccc">prime</span> <span style="color: #3399cc">!=</span> <span style="color: #cd00cd">0</span> <span style="color: #cccccc">{</span>
			<span style="color: #cccccc">out</span> <span style="color: #3399cc">&lt;-</span> <span style="color: #cccccc">i</span>
		<span style="color: #cccccc">}</span>
	<span style="color: #cccccc">}</span>
<span style="color: #cccccc">}</span>
</pre></div>

</pre>
  </section>
    <section>
      <h3>Concurrent prime sieve</h3>
      <canvas data-sample="primesieve" style="display:inline"></canvas>
    </section>
  <section>
    <h3>GOMAXPROCS</h3><img src="images/gomaxprocs.png"/>
  </section>
    <section>
      <h3>GOMAXPROCS = 1</h3>
      <canvas data-sample="gomaxprocs1" style="display:inline"></canvas>
    </section>
    <section>
      <h3>GOMAXPROCS = 24</h3>
      <canvas data-sample="gomaxprocs24" style="display:inline"></canvas>
    </section>
  <section><br/><br/><br/>
    <h3>Goroutines leak</h3>
  </section>
    <section>
      <h3>Goroutines leak</h3>
      <canvas data-sample="leakage" style="display:inline"></canvas>
    </section>
  <section><br/><br/><br/>
    <h3>Go Concurrency Tracer</h3>
    <ul>
      <li>Uses go execution tracer (go tool trace)</li>
      <li>Rewrites your code and runs it</li>
      <li>Collect the trace</li>
      <li>Analyze and correlate events</li>
      <li>Start web-server serving WebGL visualization</li>
    </ul>
  </section>
  <section><br/><br/><br/>
    <h3>Go Concurrency Tracer</h3>
    <ul>
      <li>Will be open-sourced today</li>
      <li><a href="https://github.com/divan/gotrace" target="_blank">github.com/divan/gotrace</a></li>
      <li>Requires patched Go (or pre-made docker images)</li>
    </ul>
  </section>
  <section><br/>
    <h3>Rob Pike - Concurrency is not parallelism</h3><br/><a href="https://www.youtube.com/watch?v=cN_DpYBzKso" target="_blank"><img src="images/video.png" width="70%"/></a>
  </section>
  <section><br/><br/><br/>
    <h3>Concurrency vs Parallelism</h3>
    <ul>
      <li>What is parallelism?</li>
      <li>What is concurrency?</li>
      <li>Let's visualize it.</li>
    </ul>
  </section>
    <section>
      <h3>That is parallelism</h3>
      <canvas data-sample="parallelism00" style="display:inline"></canvas>
    </section>
    <section>
      <h3>That is parallelism</h3>
      <canvas data-sample="parallelism01" style="display:inline"></canvas>
    </section>
    <section>
      <h3>That is parallelism</h3>
      <canvas data-sample="parallelism02" style="display:inline"></canvas>
    </section>
    <section>
      <h3>And that is concurrency</h3>
      <canvas data-sample="primesieve" style="display:inline"></canvas>
    </section>
    <section>
      <h3>That is concurrency</h3>
      <canvas data-sample="pingpong36" style="display:inline"></canvas>
    </section>
    <section>
      <h3>That is concurrency</h3>
      <canvas data-sample="server03" style="display:inline"></canvas>
    </section>
    <section>
      <h3>That is concurrency</h3>
      <canvas data-sample="workers01" style="display:inline"></canvas>
    </section>
    <section>
      <h3>That is concurrency</h3>
      <canvas data-sample="workers02" style="display:inline"></canvas>
    </section>
  <section><br/><br/><br/><br/><br/>
    <h1>Thank you</h1>
  </section>
</div>