
<!-- vi: set ts=2 :--><!DOCTYPE html(lang='en.png')>
<head>
  <meta charset="utf-8"/>
  <title>Visualising concurrency in Go</title>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
  <link rel="stylesheet" href="css/main.css"/>
  <link rel="stylesheet" href="css/theme/default.css"/>
  <link rel="stylesheet" href="css/custom.css"/>
  <link rel="stylesheet" href="lib/css/zenburn.css"/>
  <body>
    <div class="reveal">
      <div class="state-background"></div>
      <div class="slides">
        <section><br/><br/><br/>
          <h1>Visualizing Concurrency in Go</h1>
          <h5>Murcia Meetup Day, May 20, 2017</h5>
          <h5>Ivan Danyliuk, @idanyliuk</h5>
        </section>
        <section><img src="images/qr.png" width="40%"/></section>
        <section><br/>
          <h3>What is Go?</h3><br/>
          <pre style="width: 47%; float: left; padding: 5px">
            <ul class="part">
              <li>made by Google</li>
              <li>open-sourced in 2009</li>
              <li>static-typed, compiled</li>
              <li>"system" language</li>
            </ul></pre>
          <pre style="width: 43%; float: right; padding: 5px"><img src="images/gopher.png" width="50%"/></pre>
        </section>
        <section><br/>
          <h3>What is Go?</h3><br/>
          <pre style="width: 47%; float: left; padding: 5px">
            <ul class="part">
              <li>garbage collected</li>
              <li>simplicity</li>
              <li>only 25 keywords</li>
              <li>sub-second compilation</li>
              <li>designed for scale</li>
            </ul></pre>
          <pre style="width: 43%; float: right; padding: 5px"><img src="images/gopher.png" width="50%"/></pre>
        </section>
        <section><br/>
          <h3>What is Go?</h3><br/>
          <pre style="width: 47%; float: left; padding: 5px">
            <ul class="part">
              <li>OOP, but no classes</li>
              <li>built-in test/format/docs</li>
              <li>opinionated</li>
              <li>unusually cool stdlib</li>
            </ul></pre>
          <pre style="width: 43%; float: right; padding: 5px"><img src="images/gopher.png" width="50%"/></pre>
        </section>
        <section><br/>
          <h3>How fast is Go?</h3><br/><a href="http://benchmarksgame.alioth.debian.org/u64q/which-programs-are-fastest.html" target="_blank">http://benchmarksgame.alioth.debian.org/u64q/which-programs-are-fastest.html</a><img src="images/bench.png" width="100%"/>
        </section>
        <section><br/>
          <h3>Who uses Go?</h3><br/>
          <ul>
            <li>servers/microservices</li>
            <li>databases</li>
            <li>cloud software</li>
            <li>infrastructures</li>
            <li>blockchain stuff</li>
          </ul>
        </section>
        <section><br/><br/><br/><br/><br/><br/><br/>
          <h2>Go makes programming fun again</h2>
        </section>
        <section><br/>
          <h3>DevOps love Go</h3><br/>
          <ul>
            <li>super easy deployment</li>
            <li>cross-compilation</li>
            <li>simplicity</li>
            <li>tooling</li>
          </ul>
        </section>
        <section><img src="images/go_in_production.png" width="95%"/></section>
        <section><br/><br/><br/><br/><br/><br/><br/>
          <h1>Concurrency</h1>
        </section>
        <section><br/>
          <h2>What is</h2>
          <h2>concurrency</h2><br/>
          <ul>
            <li>a way to structure the program</li>
            <li>in a decomposable way</li>
          </ul>
        </section>
        <section><br/>
          <h2>Concurrency</h2>
          <h2>is not parallelism</h2><br/>
          <ul>
            <li>concurrency is a design technique</li>
            <li>parallelism is an optimization technique</li>
          </ul>
        </section>
        <section><img src="images/cpu.gif" width="90%"/></section>
        <section>
          <h5>40 years of CPU</h5><img src="images/cpu_trends.png" width="80%"/>
        </section>
        <section>
          <h5>CPU cores trend</h5><img src="images/cores.png" width="90%"/>
        </section>
        <section><br/><br/><br/><br/><br/><br/><br/>
          <h2>Concurrency</h2>
          <h2>is hard</h2>
        </section>
        <section>
          <h3>CSP by Tony Hoare</h3><img src="images/hoare.jpg" width="100%"/>
        </section>
        <section>
          <h3>CSP by Tony Hoare</h3><img src="images/csp.png" width="100%"/>
        </section>
        <section><br/><br/><br/><br/><br/><br/><br/>
          <h5>Do not communicate by sharing memory;</h5>
          <h5>share memory by communicating.</h5>
        </section>
        <section><br/>
          <h2>Go Concurrency</h2><br/>
          <ul>
            <li>goroutine</li>
            <li>channel</li>
          </ul>
        </section>
        <section transition="none"><br/>
          <h3>Goroutine</h3><br/>
          <ul>
            <li>is a lightweight 'process'</li>
            <li>just prefix func with 'go'</li>
            <li>similar to '&' in UNIX</li>
          </ul>
          <pre><!-- HTML generated using hilite.me --><div style="background: #000000; overflow:auto;width:auto;border: none; border-width: 0px; padding: 0em; background: #111; font-size: 125px"><pre style="margin: 0; line-height: 125%"><span style="color: #cdcd00">go</span> <span style="color: #cccccc">foo()</span>
</pre></div>
</pre>
        </section>
        <section transition="none"><br/>
          <h3>Channel</h3><br/>
          <ul>
            <li>allows passing messages between goroutines</li>
            <li>similar to pipe in UNIX</li>
          </ul>
          <pre><!-- HTML generated using hilite.me --><div style="background: #000000; overflow:auto;width:auto;border: none; border-width: 0px; padding: 0em; background: #111; font-size: 48px;"><pre style="margin: 0; line-height: 125%"><span style="color: #a0a0f0">// send 42 to channel</span>
<span style="color: #cccccc">ch</span> <span style="color: #3399cc">&lt;-</span> <span style="color: #cd00cd">42</span>
<span style="color: #3399cc">...</span>
<span style="color: #a0a0f0">// read 42 from channel</span>
<span style="color: #cccccc">val</span> <span style="color: #3399cc">:=</span> <span style="color: #3399cc">&lt;-</span><span style="color: #cccccc">ch</span>
</pre></div>

</pre>
        </section>
        <section><br/>
          <h2>Go concurrency</h2><br/>
          <ul>
            <li>Run new logical 'thread' - 3 characters</li>
            <li>Create pool of goroutines - 3 lines of code</li>
            <li>Correctness - automatically</li>
          </ul><br/>
        </section>
        <section><br/><br/><br/><br/><br/><br/>
          <h3>Concurrent programming</h3>
          <h3>has never</h3>
          <h3>been easier</h3><br/>
        </section>
        <section><br/>
          <h2>New questions</h2><br/>
          <ul>
            <li>How do we teach it?</li>
            <li>How we build more complex abstractions?</li>
            <li>How we build concurrent pipelines?</li>
            <li>How do we understand it, after all?</li>
          </ul><br/>
        </section>
        <section><br/>
          <h2>Gotrace</h2><br/><br/><br/>
          <p style="font-size: 1.8em">Tool for visualizing Go concurrency using WebGL:</p><br/>
          <p style="font-size: 1.8em"><a href="https://github.com/divan/gotrace" target="_blank">github.com/divan/gotrace</a></p><br/>
        </section>
        <section>
          <h3>Hello, world!</h3>
          <pre><!-- HTML generated using hilite.me --><div style="background: #000000; overflow:auto;width:auto;border: none; border-width: 0px; padding: 0em; background: #111; font-size: 1.8em"><pre style="margin: 0; line-height: 125%"><span style="color: #cd00cd">package</span> <span style="color: #cccccc">main</span>

<span style="color: #00cd00">func</span> <span style="color: #cccccc">main()</span> <span style="color: #cccccc">{</span>
    <span style="color: #cccccc">ch</span> <span style="color: #3399cc">:=</span> <span style="color: #cd00cd">make</span><span style="color: #cccccc">(</span><span style="color: #00cd00">chan</span> <span style="color: #00cd00">int</span><span style="color: #cccccc">)</span>

    <span style="color: #cdcd00">go</span> <span style="color: #00cd00">func</span><span style="color: #cccccc">()</span> <span style="color: #cccccc">{</span>
        <span style="color: #cccccc">ch</span> <span style="color: #3399cc">&lt;-</span> <span style="color: #cd00cd">42</span>
    <span style="color: #cccccc">}()</span>

    <span style="color: #3399cc">&lt;-</span><span style="color: #cccccc">ch</span>
<span style="color: #cccccc">}</span>
</pre></div>

</pre>
        </section>
                <section>
                  <h3>Hello, world!</h3>
                  <canvas data-sample="hello01" style="display:inline"></canvas>
                </section>
        <section>
          <h3>Timer</h3>
          <pre><!-- HTML generated using hilite.me --><div style="background: #000000; overflow:auto;width:auto;border: none; border-width: 0px; padding: 0em; background: #111; font-size: 1.4em"><pre style="margin: 0; line-height: 125%"><span style="color: #00cd00">func</span> <span style="color: #cccccc">tick(d</span> <span style="color: #cccccc">time.Duration)</span> <span style="color: #3399cc">&lt;-</span><span style="color: #00cd00">chan</span> <span style="color: #00cd00">int</span> <span style="color: #cccccc">{</span>
	<span style="color: #cccccc">c</span> <span style="color: #3399cc">:=</span> <span style="color: #cd00cd">make</span><span style="color: #cccccc">(</span><span style="color: #00cd00">chan</span> <span style="color: #00cd00">int</span><span style="color: #cccccc">)</span>
	<span style="color: #cdcd00">go</span> <span style="color: #00cd00">func</span><span style="color: #cccccc">()</span> <span style="color: #cccccc">{</span>
		<span style="color: #cccccc">time.Sleep(d)</span>
		<span style="color: #cccccc">c</span> <span style="color: #3399cc">&lt;-</span> <span style="color: #cd00cd">1</span>
	<span style="color: #cccccc">}()</span>
	<span style="color: #cdcd00">return</span> <span style="color: #cccccc">c</span>
<span style="color: #cccccc">}</span>

<span style="color: #00cd00">func</span> <span style="color: #cccccc">main()</span> <span style="color: #cccccc">{</span>
	<span style="color: #cdcd00">for</span> <span style="color: #cccccc">i</span> <span style="color: #3399cc">:=</span> <span style="color: #cd00cd">0</span><span style="color: #cccccc">;</span> <span style="color: #cccccc">i</span> <span style="color: #cccccc">&lt;</span> <span style="color: #cd00cd">24</span><span style="color: #cccccc">;</span> <span style="color: #cccccc">i</span><span style="color: #3399cc">++</span> <span style="color: #cccccc">{</span>
		<span style="color: #cccccc">c</span> <span style="color: #3399cc">:=</span> <span style="color: #cccccc">tick(</span><span style="color: #cd00cd">100</span> <span style="color: #3399cc">*</span> <span style="color: #cccccc">time.Millisecond)</span>
		<span style="color: #3399cc">&lt;-</span><span style="color: #cccccc">c</span>
	<span style="color: #cccccc">}</span>
<span style="color: #cccccc">}</span>
</pre></div>

</pre>
        </section>
                <section>
                  <h3>Timer</h3>
                  <canvas data-sample="timer01" style="display:inline"></canvas>
                </section>
        <section>
          <h3>Ping-pong</h3>
          <pre><!-- HTML generated using hilite.me --><div style="background: #000000; overflow:auto;width:auto;border: none; border-width: 0px; padding: 0em; background: #111; font-size: 1.2em"><pre style="margin: 0; line-height: 125%"><span style="color: #00cd00">func</span> <span style="color: #cccccc">main()</span> <span style="color: #cccccc">{</span>
	<span style="color: #00cd00">var</span> <span style="color: #cccccc">Ball</span> <span style="color: #00cd00">int</span>
	<span style="color: #cccccc">table</span> <span style="color: #3399cc">:=</span> <span style="color: #cd00cd">make</span><span style="color: #cccccc">(</span><span style="color: #00cd00">chan</span> <span style="color: #00cd00">int</span><span style="color: #cccccc">)</span>
	<span style="color: #cdcd00">go</span> <span style="color: #cccccc">player(table)</span>
	<span style="color: #cdcd00">go</span> <span style="color: #cccccc">player(table)</span>

	<span style="color: #cccccc">table</span> <span style="color: #3399cc">&lt;-</span> <span style="color: #cccccc">Ball</span>
	<span style="color: #cccccc">time.Sleep(</span><span style="color: #cd00cd">1</span> <span style="color: #3399cc">*</span> <span style="color: #cccccc">time.Second)</span>
	<span style="color: #3399cc">&lt;-</span><span style="color: #cccccc">table</span>
<span style="color: #cccccc">}</span>

<span style="color: #00cd00">func</span> <span style="color: #cccccc">player(table</span> <span style="color: #00cd00">chan</span> <span style="color: #00cd00">int</span><span style="color: #cccccc">)</span> <span style="color: #cccccc">{</span>
	<span style="color: #cdcd00">for</span> <span style="color: #cccccc">{</span>
		<span style="color: #cccccc">ball</span> <span style="color: #3399cc">:=</span> <span style="color: #3399cc">&lt;-</span><span style="color: #cccccc">table</span>
		<span style="color: #cccccc">ball</span><span style="color: #3399cc">++</span>
		<span style="color: #cccccc">time.Sleep(</span><span style="color: #cd00cd">100</span> <span style="color: #3399cc">*</span> <span style="color: #cccccc">time.Millisecond)</span>
		<span style="color: #cccccc">table</span> <span style="color: #3399cc">&lt;-</span> <span style="color: #cccccc">ball</span>
	<span style="color: #cccccc">}</span>
<span style="color: #cccccc">}</span>
</pre></div>
</pre>
        </section>
                <section>
                  <h3>Ping-pong</h3>
                  <canvas data-sample="pingpong01" style="display:inline"></canvas>
                </section>
        <section transition="none">
          <h3>Ping-pong #3</h3>
          <pre><!-- HTML generated using hilite.me --><div style="background: #000000; overflow:auto;width:auto;border: none; border-width: 0px; padding: 0em; background: #111;"><pre style="margin: 0; line-height: 125%"> <span style="opacity: 0.5"> <span style="color: #00cd00">func</span> <span style="color: #cccccc">main()</span> <span style="color: #cccccc">{</span>
	<span style="color: #00cd00">var</span> <span style="color: #cccccc">Ball</span> <span style="color: #00cd00">int</span>
	<span style="color: #cccccc">table</span> <span style="color: #3399cc">:=</span> <span style="color: #cd00cd">make</span><span style="color: #cccccc">(</span><span style="color: #00cd00">chan</span> <span style="color: #00cd00">int</span><span style="color: #cccccc">)</span> </span>
	<span style="opacity: 1">
	<span style="color: #cdcd00">go</span> <span style="color: #cccccc">player(table)</span>
	<span style="color: #cdcd00">go</span> <span style="color: #cccccc">player(table)</span>
	<span style="color: #cdcd00">go</span> <span style="color: #cccccc">player(table)</span>
	</span>
	<span style="opacity: 0.5"><span style="color: #cccccc">table</span> <span style="color: #3399cc">&lt;-</span> <span style="color: #cccccc">Ball</span>
	<span style="color: #cccccc">time.Sleep(</span><span style="color: #cd00cd">1</span> <span style="color: #3399cc">*</span> <span style="color: #cccccc">time.Second)</span>
	<span style="color: #3399cc">&lt;-</span><span style="color: #cccccc">table</span>
<span style="color: #cccccc">}</span>

<span style="color: #00cd00">func</span> <span style="color: #cccccc">player(table</span> <span style="color: #00cd00">chan</span> <span style="color: #00cd00">int</span><span style="color: #cccccc">)</span> <span style="color: #cccccc">{</span>
	<span style="color: #cdcd00">for</span> <span style="color: #cccccc">{</span>
		<span style="color: #cccccc">ball</span> <span style="color: #3399cc">:=</span> <span style="color: #3399cc">&lt;-</span><span style="color: #cccccc">table</span>
		<span style="color: #cccccc">ball</span><span style="color: #3399cc">++</span>
		<span style="color: #cccccc">time.Sleep(</span><span style="color: #cd00cd">100</span> <span style="color: #3399cc">*</span> <span style="color: #cccccc">time.Millisecond)</span>
		<span style="color: #cccccc">table</span> <span style="color: #3399cc">&lt;-</span> <span style="color: #cccccc">ball</span>
	<span style="color: #cccccc">}</span>
<span style="color: #cccccc">}</span> </span> </pre></div>
</pre>
        </section>
                <section>
                  <h3>Ping-pong #3</h3>
                  <canvas data-sample="pingpong03" style="display:inline"></canvas>
                </section>
        <section>
          <h3>Ping-pong #36</h3>
          <pre><!-- HTML generated using hilite.me --><div style="background: #000000; overflow:auto;width:auto;border: none; border-width: 0px; padding: 0em; background: #111;"><pre style="margin: 0; line-height: 125%"><span style="opacity: 0.5"><span style="color: #00cd00">func</span> <span style="color: #cccccc">main()</span> <span style="color: #cccccc">{</span>
	<span style="color: #00cd00">var</span> <span style="color: #cccccc">Ball</span> <span style="color: #00cd00">int</span>
	<span style="color: #cccccc">table</span> <span style="color: #3399cc">:=</span> <span style="color: #cd00cd">make</span><span style="color: #cccccc">(</span><span style="color: #00cd00">chan</span> <span style="color: #00cd00">int</span><span style="color: #cccccc">)</span></span>

	<span style="opacity: 1"><span style="color: #cdcd00">for</span> <span style="color: #cccccc">i</span> <span style="color: #3399cc">:=</span> <span style="color: #cd00cd">0</span><span style="color: #cccccc">;</span> <span style="color: #cccccc">i</span> <span style="color: #cccccc">&lt;</span> <span style="color: #cd00cd">36</span><span style="color: #cccccc">;</span> <span style="color: #cccccc">i</span><span style="color: #3399cc">++</span> <span style="color: #cccccc">{</span>
		<span style="color: #cdcd00">go</span> <span style="color: #cccccc">player(table)</span>
	<span style="color: #cccccc">}</span></span>

	<span style="opacity:0.5"><span style="color: #cccccc">table</span> <span style="color: #3399cc">&lt;-</span> <span style="color: #cccccc">Ball</span>
	<span style="color: #cccccc">time.Sleep(</span><span style="color: #cd00cd">1</span> <span style="color: #3399cc">*</span> <span style="color: #cccccc">time.Second)</span>
	<span style="color: #3399cc">&lt;-</span><span style="color: #cccccc">table</span>
<span style="color: #cccccc">}</span>

<span style="color: #00cd00">func</span> <span style="color: #cccccc">player(table</span> <span style="color: #00cd00">chan</span> <span style="color: #00cd00">int</span><span style="color: #cccccc">)</span> <span style="color: #cccccc">{</span>
	<span style="color: #cdcd00">for</span> <span style="color: #cccccc">{</span>
		<span style="color: #cccccc">ball</span> <span style="color: #3399cc">:=</span> <span style="color: #3399cc">&lt;-</span><span style="color: #cccccc">table</span>
		<span style="color: #cccccc">ball</span><span style="color: #3399cc">++</span>
		<span style="color: #cccccc">time.Sleep(</span><span style="color: #cd00cd">100</span> <span style="color: #3399cc">*</span> <span style="color: #cccccc">time.Millisecond)</span>
		<span style="color: #cccccc">table</span> <span style="color: #3399cc">&lt;-</span> <span style="color: #cccccc">ball</span>
	<span style="color: #cccccc">}</span>
<span style="color: #cccccc">}</span></span>
</pre></div>
</pre>
        </section>
                <section>
                  <h3>Ping-pong #36</h3>
                  <canvas data-sample="pingpong36" style="display:inline"></canvas>
                </section>
        <section><br/><br/><br/><br/><br/>
          <h1>Messaging patterns</h1>
        </section>
        <section>
          <h3>Fan-in</h3>
          <pre><!-- HTML generated using hilite.me --><div style="background: #000000; overflow:auto;width:auto;border: none; border-width: 0px; padding: 0em; background: #111;"><pre style="margin: 0; line-height: 125%"><span style="color: #00cd00">func</span> <span style="color: #cccccc">producer(ch</span> <span style="color: #00cd00">chan</span> <span style="color: #00cd00">int</span><span style="color: #cccccc">,</span> <span style="color: #cccccc">d</span> <span style="color: #cccccc">time.Duration)</span> <span style="color: #cccccc">{</span>
	<span style="color: #cdcd00">for</span> <span style="color: #cccccc">{</span>
		<span style="color: #cccccc">ch</span> <span style="color: #3399cc">&lt;-</span> <span style="color: #cccccc">i</span>
		<span style="color: #cccccc">time.Sleep(d)</span>
	<span style="color: #cccccc">}</span>
<span style="color: #cccccc">}</span>

<span style="color: #00cd00">func</span> <span style="color: #cccccc">reader(out</span> <span style="color: #00cd00">chan</span> <span style="color: #00cd00">int</span><span style="color: #cccccc">)</span> <span style="color: #cccccc">{</span>
	<span style="color: #cdcd00">for</span> <span style="color: #cccccc">{</span> <span style="color: #3399cc">&lt;-</span><span style="color: #cccccc">out</span> <span style="color: #cccccc">}</span>
<span style="color: #cccccc">}</span>

<span style="color: #00cd00">func</span> <span style="color: #cccccc">main()</span> <span style="color: #cccccc">{</span>
	<span style="color: #cccccc">ch,</span> <span style="color: #cccccc">out</span> <span style="color: #3399cc">:=</span> <span style="color: #cd00cd">make</span><span style="color: #cccccc">(</span><span style="color: #00cd00">chan</span> <span style="color: #00cd00">int</span><span style="color: #cccccc">),</span> <span style="color: #cd00cd">make</span><span style="color: #cccccc">(</span><span style="color: #00cd00">chan</span> <span style="color: #00cd00">int</span><span style="color: #cccccc">)</span>
	<span style="color: #cdcd00">go</span> <span style="color: #cccccc">producer(ch,</span> <span style="color: #cd00cd">100</span><span style="color: #3399cc">*</span><span style="color: #cccccc">time.Millisecond)</span>
	<span style="color: #cdcd00">go</span> <span style="color: #cccccc">producer(ch,</span> <span style="color: #cd00cd">300</span><span style="color: #3399cc">*</span><span style="color: #cccccc">time.Millisecond)</span>
	<span style="color: #cdcd00">go</span> <span style="color: #cccccc">reader(out)</span>
	<span style="color: #cdcd00">for</span> <span style="color: #cccccc">{</span> <span style="color: #cccccc">out</span> <span style="color: #3399cc">&lt;-</span> <span style="color: #3399cc">&lt;-</span><span style="color: #cccccc">ch</span> <span style="color: #cccccc">}</span>
<span style="color: #cccccc">}</span>
</pre></div>

</pre>
        </section>
                <section>
                  <h3>Fan in</h3>
                  <canvas data-sample="fanin" style="display:inline"></canvas>
                </section>
        <section>
          <h3>Servers</h3>
          <pre><!-- HTML generated using hilite.me --><div style="background: #000000; overflow:auto;width:auto;border: none; border-width: 0px; padding: 0em; background: #111;"><pre style="margin: 0; line-height: 125%"><span style="color: #00cd00">func</span> <span style="color: #cccccc">handler(c</span> <span style="color: #cccccc">net.Conn)</span> <span style="color: #cccccc">{</span>
	<span style="color: #cccccc">c.Write([]</span><span style="color: #cd00cd">byte</span><span style="color: #cccccc">(</span><span style="color: #cd0000">&quot;ok&quot;</span><span style="color: #cccccc">))</span>
	<span style="color: #cccccc">c.Close()</span>
<span style="color: #cccccc">}</span>

<span style="color: #00cd00">func</span> <span style="color: #cccccc">main()</span> <span style="color: #cccccc">{</span>
	<span style="color: #cccccc">l,</span> <span style="color: #cccccc">err</span> <span style="color: #3399cc">:=</span> <span style="color: #cccccc">net.Listen(</span><span style="color: #cd0000">&quot;tcp&quot;</span><span style="color: #cccccc">,</span> <span style="color: #cd0000">&quot;:5000&quot;</span><span style="color: #cccccc">)</span>
	<span style="color: #cdcd00">if</span> <span style="color: #cccccc">err</span> <span style="color: #3399cc">!=</span> <span style="color: #cdcd00">nil</span> <span style="color: #cccccc">{</span>
		<span style="color: #cd00cd">panic</span><span style="color: #cccccc">(err)</span>
	<span style="color: #cccccc">}</span>
	<span style="color: #cdcd00">for</span> <span style="color: #cccccc">{</span>
		<span style="color: #cccccc">c,</span> <span style="color: #cccccc">err</span> <span style="color: #3399cc">:=</span> <span style="color: #cccccc">l.Accept()</span>
		<span style="color: #cdcd00">if</span> <span style="color: #cccccc">err</span> <span style="color: #3399cc">!=</span> <span style="color: #cdcd00">nil</span> <span style="color: #cccccc">{</span>
			<span style="color: #cdcd00">continue</span>
		<span style="color: #cccccc">}</span>
		<span style="color: #cdcd00">go</span> <span style="color: #cccccc">handler(c)</span>
	<span style="color: #cccccc">}</span>
<span style="color: #cccccc">}</span>
</pre></div>

</pre>
        </section>
                <section>
                  <h3>Servers</h3>
                  <canvas data-sample="server01" style="display:inline"></canvas>
                </section>
        <section>
          <h3>Servers</h3>
          <pre style="width: 55%; float: left; padding: 5px"><!-- HTML generated using hilite.me --><div style="background: #000000; overflow:auto;width:auto;border: none; border-width: 0px; padding: 0em; background: #111;"><pre style="margin: 0; line-height: 125%"><span style="color: #00cd00">func</span> <span style="color: #cccccc">handler(c</span> <span style="color: #cccccc">net.Conn,</span> <span style="color: #cccccc">ch</span> <span style="color: #00cd00">chan</span> <span style="color: #00cd00">string</span><span style="color: #cccccc">)</span> <span style="color: #cccccc">{</span>
	<span style="color: #cccccc">ch</span> <span style="color: #3399cc">&lt;-</span> <span style="color: #cd00cd">11</span> <span style="color: #000080">// something</span>
	<span style="color: #cccccc">c.Write([]</span><span style="color: #cd00cd">byte</span><span style="color: #cccccc">(</span><span style="color: #cd0000">&quot;ok&quot;</span><span style="color: #cccccc">))</span>
	<span style="color: #cccccc">c.Close()</span>
<span style="color: #cccccc">}</span>

<span style="opacity: 0.5"><span style="color: #00cd00">func</span> <span style="color: #cccccc">main()</span> <span style="color: #cccccc">{</span>
	<span style="color: #cccccc">l,</span> <span style="color: #cccccc">err</span> <span style="color: #3399cc">:=</span> <span style="color: #cccccc">net.Listen(</span><span style="color: #cd0000">&quot;tcp&quot;</span><span style="color: #cccccc">,</span> <span style="color: #cd0000">&quot;:5000&quot;</span><span style="color: #cccccc">)</span>
	<span style="color: #cdcd00">if</span> <span style="color: #cccccc">err</span> <span style="color: #3399cc">!=</span> <span style="color: #cdcd00">nil</span> <span style="color: #cccccc">{</span>
		<span style="color: #cd00cd">panic</span><span style="color: #cccccc">(err)</span>
	<span style="color: #cccccc">}</span></span>
	<span style="color: #cccccc">ch</span> <span style="color: #3399cc">:=</span> <span style="color: #cd00cd">make</span><span style="color: #cccccc">(</span><span style="color: #00cd00">chan</span> <span style="color: #00cd00">string</span><span style="color: #cccccc">)</span>
	<span style="color: #cdcd00">go</span> <span style="color: #cccccc">logger(ch)</span>
	<span style="opacity: 0.5"><span style="color: #cdcd00">go</span> <span style="color: #cccccc">server(l,</span> <span style="color: #cccccc">ch)</span>
	<span style="color: #cdcd00">select</span><span style="color: #cccccc">{}</span>
<span style="color: #cccccc">}</span></span>
</pre></div>

</pre>
          <pre style="width: 43%; float: right; padding: 5px"><!-- HTML generated using hilite.me --><div style="background: #000000; overflow:auto;width:auto;border: none; border-width: 0px; padding: 0em; background: #111;"><pre style="margin: 0; line-height: 125%"><span style="color: #00cd00">func</span> <span style="color: #cccccc">logger(ch</span> <span style="color: #00cd00">chan</span> <span style="color: #00cd00">int</span><span style="color: #cccccc">)</span> <span style="color: #cccccc">{</span>
	<span style="color: #cdcd00">for</span> <span style="color: #cccccc">{</span>
		<span style="color: #cccccc">fmt.Println(</span><span style="color: #3399cc">&lt;-</span><span style="color: #cccccc">ch)</span>
	<span style="color: #cccccc">}</span>
<span style="color: #cccccc">}</span>

<span style="opacity: 0.5"><span style="color: #00cd00">func</span> <span style="color: #cccccc">server(l</span> <span style="color: #cccccc">net.Listener,</span>
		<span style="color: #cccccc">ch</span> <span style="color: #00cd00">chan</span> <span style="color: #00cd00">int</span><span style="color: #cccccc">)</span> <span style="color: #cccccc">{</span>
	<span style="color: #cdcd00">for</span> <span style="color: #cccccc">{</span>
		<span style="color: #cccccc">c,</span> <span style="color: #cccccc">err</span> <span style="color: #3399cc">:=</span> <span style="color: #cccccc">l.Accept()</span>
		<span style="color: #cdcd00">if</span> <span style="color: #cccccc">err</span> <span style="color: #3399cc">!=</span> <span style="color: #cdcd00">nil</span> <span style="color: #cccccc">{</span>
			<span style="color: #cdcd00">continue</span>
		<span style="color: #cccccc">}</span>
		<span style="color: #cdcd00">go</span> <span style="color: #cccccc">handler(c,</span> <span style="color: #cccccc">ch)</span>
	<span style="color: #cccccc">}</span>
<span style="color: #cccccc">}</span></span>
</pre></div>

</pre>
        </section>
                <section>
                  <h3>Servers</h3>
                  <canvas data-sample="server02" style="display:inline"></canvas>
                </section>
        <section>
          <h3>Workers / Fan-out</h3>
          <pre style="width: 40%; float: left; padding: 5px"><!-- HTML generated using hilite.me --><div style="background: #000000; overflow:auto;width:auto;border: none; border-width: 0px; padding: 0em; background: #111;"><pre style="margin: 0; line-height: 125%"><span style="color: #00cd00">func</span> <span style="color: #cccccc">main()</span> <span style="color: #cccccc">{</span>
	<span style="color: #00cd00">var</span> <span style="color: #cccccc">wg</span> <span style="color: #cccccc">sync.WaitGroup</span>
	<span style="color: #cccccc">wg.Add(</span><span style="color: #cd00cd">36</span><span style="color: #cccccc">)</span>
	<span style="color: #cdcd00">go</span> <span style="color: #cccccc">pool(</span><span style="color: #3399cc">&amp;</span><span style="color: #cccccc">wg,</span> <span style="color: #cd00cd">36</span><span style="color: #cccccc">)</span>
	<span style="color: #cccccc">wg.Wait()</span>
<span style="color: #cccccc">}</span>

<span style="color: #00cd00">func</span> <span style="color: #cccccc">pool(wg</span> <span style="color: #3399cc">*</span><span style="color: #cccccc">sync.WaitGroup,</span> <span style="color: #cccccc">n</span> <span style="color: #00cd00">int</span><span style="color: #cccccc">)</span> <span style="color: #cccccc">{</span>
	<span style="color: #cccccc">tasks</span> <span style="color: #3399cc">:=</span> <span style="color: #cd00cd">make</span><span style="color: #cccccc">(</span><span style="color: #00cd00">chan</span> <span style="color: #00cd00">int</span><span style="color: #cccccc">)</span>
	<span style="color: #cdcd00">for</span> <span style="color: #cccccc">i</span> <span style="color: #3399cc">:=</span> <span style="color: #cd00cd">0</span><span style="color: #cccccc">;</span> <span style="color: #cccccc">i</span> <span style="color: #cccccc">&lt;</span> <span style="color: #cccccc">n;</span> <span style="color: #cccccc">i</span><span style="color: #3399cc">++</span> <span style="color: #cccccc">{</span>
		<span style="color: #cdcd00">go</span> <span style="color: #cccccc">worker(tasks,</span> <span style="color: #cccccc">wg)</span>
	<span style="color: #cccccc">}</span>
	<span style="color: #cdcd00">for</span> <span style="color: #cccccc">i</span> <span style="color: #3399cc">:=</span> <span style="color: #cd00cd">0</span><span style="color: #cccccc">;</span> <span style="color: #cccccc">i</span> <span style="color: #cccccc">&lt;</span> <span style="color: #cd00cd">50</span><span style="color: #cccccc">;</span> <span style="color: #cccccc">i</span><span style="color: #3399cc">++</span> <span style="color: #cccccc">{</span>
		<span style="color: #cccccc">tasks</span> <span style="color: #3399cc">&lt;-</span> <span style="color: #cccccc">i</span>
	<span style="color: #cccccc">}</span>
	<span style="color: #cd00cd">close</span><span style="color: #cccccc">(tasks)</span>
<span style="color: #cccccc">}</span>
</pre></div>

</pre>
          <pre style="width: 55%; float: right; padding: 5px"><!-- HTML generated using hilite.me --><div style="background: #000000; overflow:auto;width:auto;border: none; border-width: 0px; padding: 0em; background: #111;"><pre style="margin: 0; line-height: 125%"><span style="color: #00cd00">func</span> <span style="color: #cccccc">worker(tasks</span> <span style="color: #3399cc">&lt;-</span><span style="color: #00cd00">chan</span> <span style="color: #00cd00">int</span><span style="color: #cccccc">,</span>
		<span style="color: #cccccc">wg</span> <span style="color: #3399cc">*</span><span style="color: #cccccc">sync.WaitGroup)</span> <span style="color: #cccccc">{</span>
	<span style="color: #cdcd00">defer</span> <span style="color: #cccccc">wg.Done()</span>
	<span style="color: #cdcd00">for</span> <span style="color: #cccccc">{</span>
		<span style="color: #cccccc">task,</span> <span style="color: #cccccc">ok</span> <span style="color: #3399cc">:=</span> <span style="color: #3399cc">&lt;-</span><span style="color: #cccccc">tasks</span>
		<span style="color: #cdcd00">if</span> <span style="color: #cccccc">!ok</span> <span style="color: #cccccc">{</span>
			<span style="color: #cdcd00">return</span>
		<span style="color: #cccccc">}</span>
		<span style="color: #cccccc">d</span> <span style="color: #3399cc">:=</span> <span style="color: #cccccc">time.Duration(task)</span> 
			<span style="color: #3399cc">*</span> <span style="color: #cccccc">time.Millisecond</span>
		<span style="color: #cccccc">time.Sleep(d)</span>
		<span style="color: #cccccc">fmt.Println(</span><span style="color: #cd0000">&quot;processing task&quot;</span><span style="color: #cccccc">,</span> <span style="color: #cccccc">task)</span>
	<span style="color: #cccccc">}</span>
<span style="color: #cccccc">}</span>
</pre></div>

</pre>
        </section>
                <section>
                  <h3>Workers</h3>
                  <canvas data-sample="workers01" style="display:inline"></canvas>
                </section>
                <section>
                  <h3>Subworkers</h3>
                  <canvas data-sample="workers02" style="display:inline"></canvas>
                </section>
                <section>
                  <h3>Server+Worker</h3>
                  <canvas data-sample="server03" style="display:inline"></canvas>
                </section>
        <section>
          <h3>Concurrent prime sieve</h3>
          <pre style="width: 43%; float: left; padding: 5px"><!-- HTML generated using hilite.me --><div style="background: #000000; overflow:auto;width:auto;border: none; border-width: 0px; padding: 0em; background: #111;"><pre style="margin: 0; line-height: 125%"><span style="color: #cd00cd">package</span> <span style="color: #cccccc">main</span>

<span style="color: #cd00cd">import</span> <span style="color: #cd0000">&quot;fmt&quot;</span>

<span style="color: #00cd00">func</span> <span style="color: #cccccc">main()</span> <span style="color: #cccccc">{</span>
	<span style="color: #cccccc">ch</span> <span style="color: #3399cc">:=</span> <span style="color: #cd00cd">make</span><span style="color: #cccccc">(</span><span style="color: #00cd00">chan</span> <span style="color: #00cd00">int</span><span style="color: #cccccc">)</span>
	<span style="color: #cdcd00">go</span> <span style="color: #cccccc">Generate(ch)</span>
	<span style="color: #cdcd00">for</span> <span style="color: #cccccc">i</span> <span style="color: #3399cc">:=</span> <span style="color: #cd00cd">0</span><span style="color: #cccccc">;</span> <span style="color: #cccccc">i</span> <span style="color: #cccccc">&lt;</span> <span style="color: #cd00cd">10</span><span style="color: #cccccc">;</span> <span style="color: #cccccc">i</span><span style="color: #3399cc">++</span> <span style="color: #cccccc">{</span>
		<span style="color: #cccccc">prime</span> <span style="color: #3399cc">:=</span> <span style="color: #3399cc">&lt;-</span><span style="color: #cccccc">ch</span>
		<span style="color: #cccccc">fmt.Println(prime)</span>
		<span style="color: #cccccc">out</span> <span style="color: #3399cc">:=</span> <span style="color: #cd00cd">make</span><span style="color: #cccccc">(</span><span style="color: #00cd00">chan</span> <span style="color: #00cd00">int</span><span style="color: #cccccc">)</span>
		<span style="color: #cdcd00">go</span> <span style="color: #cccccc">Filter(ch,</span> <span style="color: #cccccc">out,</span> <span style="color: #cccccc">prime)</span>
		<span style="color: #cccccc">ch</span> <span style="color: #cccccc">=</span> <span style="color: #cccccc">out</span>
	<span style="color: #cccccc">}</span>
<span style="color: #cccccc">}</span>
</pre></div>

</pre>
          <pre style="width: 55%; float: right; padding: 5px"><!-- HTML generated using hilite.me --><div style="background: #000000; overflow:auto;width:auto;border: none; border-width: 0px; padding: 0em; background: #111;"><pre style="margin: 0; line-height: 125%"><span style="color: #00cd00">func</span> <span style="color: #cccccc">Generate(ch</span> <span style="color: #00cd00">chan</span><span style="color: #3399cc">&lt;-</span> <span style="color: #00cd00">int</span><span style="color: #cccccc">)</span> <span style="color: #cccccc">{</span>
	<span style="color: #cdcd00">for</span> <span style="color: #cccccc">i</span> <span style="color: #3399cc">:=</span> <span style="color: #cd00cd">2</span><span style="color: #cccccc">;</span> <span style="color: #cccccc">;</span> <span style="color: #cccccc">i</span><span style="color: #3399cc">++</span> <span style="color: #cccccc">{</span>
		<span style="color: #cccccc">ch</span> <span style="color: #3399cc">&lt;-</span> <span style="color: #cccccc">i</span>
	<span style="color: #cccccc">}</span>
<span style="color: #cccccc">}</span>

<span style="color: #00cd00">func</span> <span style="color: #cccccc">Filter(in,</span> <span style="color: #cccccc">out</span> <span style="color: #3399cc">&lt;-</span><span style="color: #00cd00">chan</span> <span style="color: #00cd00">int</span><span style="color: #cccccc">,</span> <span style="color: #cccccc">prime</span> <span style="color: #00cd00">int</span><span style="color: #cccccc">)</span> <span style="color: #cccccc">{</span>
	<span style="color: #cdcd00">for</span> <span style="color: #cccccc">{</span>
		<span style="color: #cccccc">i</span> <span style="color: #3399cc">:=</span> <span style="color: #3399cc">&lt;-</span><span style="color: #cccccc">in</span>
		<span style="color: #cdcd00">if</span> <span style="color: #cccccc">i</span><span style="color: #3399cc">%</span><span style="color: #cccccc">prime</span> <span style="color: #3399cc">!=</span> <span style="color: #cd00cd">0</span> <span style="color: #cccccc">{</span>
			<span style="color: #cccccc">out</span> <span style="color: #3399cc">&lt;-</span> <span style="color: #cccccc">i</span>
		<span style="color: #cccccc">}</span>
	<span style="color: #cccccc">}</span>
<span style="color: #cccccc">}</span>
</pre></div>

</pre>
        </section>
                <section>
                  <h3>Concurrent prime sieve</h3>
                  <canvas data-sample="primesieve" style="display:inline"></canvas>
                </section>
                <section>
                  <h3>GOMAXPROCS = 1</h3>
                  <canvas data-sample="gomaxprocs1" style="display:inline"></canvas>
                </section>
                <section>
                  <h3>GOMAXPROCS = 24</h3>
                  <canvas data-sample="gomaxprocs24" style="display:inline"></canvas>
                </section>
        <section><br/><br/><br/><br/><br/><br/>
          <h2>Goroutines leak</h2>
        </section>
                <section>
                  <h3>Goroutines leak</h3>
                  <canvas data-sample="leakage" style="display:inline"></canvas>
                </section>
        <section><br/><br/><br/>
          <h3>Go Concurrency Tracer</h3>
          <ul>
            <li>It's open-source</li>
            <li><a href="https://github.com/divan/gotrace" target="_blank">github.com/divan/gotrace</a></li>
            <li>Uses go execution tracer (go tool trace)</li>
            <li>Requires patched Go (or pre-made docker images)</li>
            <li>(Kind of) language agnostic</li>
          </ul>
        </section>
        <section><br/><br/><br/>
          <h3>Links</h3>
          <ul>
            <li><a href="https://tour.golang.org/welcome/1" target="_blank">Tour of Go</a></li>
            <li><a href="https://www.youtube.com/watch?v=cN_DpYBzKso" target="_blank">Rob Pike - Concurrency is not parallelism</a></li>
            <li><a href="https://www.youtube.com/watch?v=QDDwwePbDtw" target="_blank">Sameer Adjmani - Advanced concurrency patterns in Go</a></li>
          </ul>
        </section>
        <section><br/><br/>
          <h3>Golang Murcia Meetups</h3><a href="https://www.meetup.com/Gophers-Murcia/" target="_blank">https://www.meetup.com/Gophers-Murcia/</a><br/><img src="images/murcia.png" width="30%"/>
        </section>
        <section><br/><br/><br/><br/><br/>
          <h1>Thank you</h1>
          <p>Twitter: @idanyliuk</p>
          <p>Github: divan</p>
        </section>
      </div>
      <div class="progress"></div><span></span>
    </div>
    <script src="lib/js/head.min.js"></script>
    <script>
      head.js(
      "lib/js/jquery.min.js",
      "lib/js/jquery.hotkeys.js",
      "lib/js/underscore.min.js",
      "lib/js/swfobject.js",
      "lib/js/dat.gui.js",
      "lib/js/EventEmitter.js",
      "lib/js/three.min.js",
      "js/gothree_helper.js",
      "lib/js/tween.js",
      "js/gothree.js",
      "lib/js/OrbitControls.js",
      'lib/js/TextGeometry.js',
      'lib/js/FontUtils.js',
      'lib/font/helvetiker_regular.typeface.js',
      "lib/js/three/EffectComposer.js",
      "lib/js/three/RenderPass.js",
      "lib/js/three/BloomPass.js",
      "lib/js/three/ShaderPass.js",
      "lib/js/three/MaskPass.js",
      "js/sugar.js",
      // js files needed for WebGL specific samples (excluding three js)
      "lib/js/J3DI.js",
      "lib/js/J3DIMath.js",
      "lib/js/webgl-utils.js",
      "lib/js/webgl-debug.js",
      // App specific js
      "js/reveal.js",
      "js/stats_bootstrap.js",
      "js/samples.js",
      function() {
      // Full list of configuration options available here:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
      controls: false,
      progress: false,
      history: true,
      mouseWheel: false,
      transition: 'linear', // default/cube/page/concave/linear(2d)
      // Optional libraries used to extend on reveal.js
      dependencies: [
      { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
      { src: 'lib/js/showdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
      { src: 'lib/js/data-markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
      ]
      });
      });
    </script>
  </body>
</head>